<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="../img/favicon.ico">
    <title>Script &mdash; ML-Lab</title>
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:400,700">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/tonsky/FiraCode@1.206/distr/fira_code.css">
    <link rel="stylesheet" href="//use.fontawesome.com/releases/v5.8.1/css/all.css">
    <link rel="stylesheet" href="//use.fontawesome.com/releases/v5.8.1/css/v4-shims.css">
    <link rel="stylesheet" href="../css/theme.css">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
    <script src="//code.jquery.com/jquery-2.1.1.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
    <script>
        hljs.initHighlightingOnLoad();
    </script> 
</head>

<body ontouchstart="">
    <div id="container">
        <aside>
            <div class="home">
                <div class="title">
                    <button class="hamburger"></button>
                    <a href=".." class="site-name"> ML-Lab</a>
                </div>
                <div class="search">
                    <div role="search">
    <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
        <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
    </form>
</div>
                </div>
            </div>
            <nav class="nav">
                <ul class="root">
                    <li class="toctree-l1"><a class="nav-item" href="..">Home</a></li>
                    <li class="toctree-l1"><a class="nav-item" href="../lessons-learned/">Lessons Learned</a></li>
                    <li class="toctree-l1 current"><a class="nav-item current" href="./">Script</a>
<ul class="subnav">
<li class="toctree-l2"><a class="nav-item toc" href="#scriptsirispy">scripts/iris.py</a></li>
<li class="toctree-l2"><a class="nav-item toc" href="#scriptsforest_vs_logitpy">scripts/forest_vs_logit.py</a></li>
<li class="toctree-l2"><a class="nav-item toc" href="#scriptsimportance_demopy">scripts/importance_demo.py</a></li>
<li class="toctree-l2"><a class="nav-item toc" href="#scriptsgridsearch_mixedpy">scripts/gridsearch_mixed.py</a></li>
<li class="toctree-l2"><a class="nav-item toc" href="#scriptspipeline_leakagepy">scripts/pipeline_leakage.py</a></li>
<li class="toctree-l2"><a class="nav-item toc" href="#convenzioni-di-output-rapido-promemoria">Convenzioni di output (rapido promemoria)</a></li>
</ul></li>
                    <li class="toctree-l1"><a class="nav-item" href="../quiz/">Quiz</a></li>
                </ul>
            </nav>
            <div class="repo">
    <div class="link">
    </div>
    <div class="previous"><a href="../lessons-learned/">&laquo; Previous</a></div>
    <div class="next"><a href="../quiz/">Next &raquo;</a></div>
</div>
        </aside>
        <div id="spacer"><button class="arrow"></button></div>
        <main>
            <div class="home-top">
                <button class="hamburger"></button>
                <a href=".." class="site-name"> ML-Lab</a>
            </div>
            <div id="main">
                <nav class="breadcrumbs">
<ul>
    
</ul>
</nav>
                <div id="content"><h1 id="script-inclusi">Script inclusi<a class="headerlink" href="#script-inclusi" title="Permanent link">&para;</a></h1>
<p>Questa pagina elenca gli script del laboratorio con <strong>cosa fanno</strong>, <strong>opzioni principali</strong> e <strong>comandi tipici</strong>.<br />
Gli script stampano report “parlanti” (metriche, confusion, analisi soglie ecc.). Alcuni includono anche gli <strong>appunti finali</strong> con <code>--print-cheatsheet</code>.</p>
<hr />
<h2 id="scriptsirispy"><code>scripts/iris.py</code><a class="headerlink" href="#scriptsirispy" title="Permanent link">&para;</a></h2>
<p><strong>Cosa:</strong> Decision Tree sull’IRIS (3 classi).<br />
<strong>Perché:</strong> capire over/underfitting con regole <strong>leggibili</strong> (SE… ALLORA…).</p>
<p><strong>Opzioni principali</strong>
- <code>--max-depth INT</code> … limita la profondità dell’albero.
- <code>--tune</code> … sceglie in modo onesto la profondità via k-fold (solo sul train).
- <code>--seed INT</code> … fissa lo split.
- <code>--print-cheatsheet</code> … stampa appunti finali (lesson learned essenziali).</p>
<p><strong>Esempi</strong></p>
<pre class="codehilite"><code class="language-bash">python scripts/iris.py
python scripts/iris.py --max-depth 3
python scripts/iris.py --tune --seed 13 --print-cheatsheet
````

**Cosa vedrai**

* Accuratezza **train/test**
* **Regole** dell’albero in testo
* **Confusion matrix** multiclasse
* **Feature importance**
* Mini **sweep** di profondità con train vs test
* (se `--tune`) scelta della profondità via CV

---

## `scripts/imbalance.py`

**Cosa:** Classificazione **sbilanciata** (Breast Cancer) con **Logistic Regression** + **scaling**.
**Perché:** mostrare che l’**accuracy** può ingannare; serve guardare **Precision/Recall/F1** e **scegliere la soglia**.

**Opzioni principali**

* `--C FLOAT` … forza del modello logit (C↑ = meno regolarizzazione).
* `--threshold FLOAT` … soglia decisione (default 0.5).
* `--auto-threshold` … sceglie la soglia da **validation** (solo train).
* `--metric {f1,youden}` … criterio per l’auto-soglia.
* `--seed INT`
* `--print-cheatsheet` … appunti finali.

**Esempi**

```bash
python scripts/imbalance.py
python scripts/imbalance.py --auto-threshold --metric f1 --print-cheatsheet
python scripts/imbalance.py --C 0.5 --seed 13
</code></pre>

<p><strong>Cosa vedrai</strong></p>
<ul>
<li><strong>Baseline</strong> (classe maggioritaria)</li>
<li><strong>Distribuzione</strong> degli score (quantili per negativi/positivi)</li>
<li><strong>Sweep soglia</strong> (tabella soglia → FP/FN/Precision/Recall/F1)</li>
<li><strong>Soglia a costo</strong> (es. FN 5× FP)</li>
<li>Report completo: Accuracy, Precision, Recall, <strong>F1</strong>, <strong>ROC-AUC</strong>, <strong>Confusion matrix</strong></li>
<li><strong>CV ROC-AUC</strong> sul train</li>
</ul>
<hr />
<h2 id="scriptsforest_vs_logitpy"><code>scripts/forest_vs_logit.py</code><a class="headerlink" href="#scriptsforest_vs_logitpy" title="Permanent link">&para;</a></h2>
<p><strong>Cosa:</strong> Confronto <strong>Random Forest</strong> vs <strong>Logistic</strong> su Breast Cancer.
Include <strong>calibrazione</strong> delle probabilità RF e <strong>scelta soglia</strong> separata per i due modelli.</p>
<p><strong>Opzioni principali</strong></p>
<ul>
<li>
<p>Soglia:</p>
</li>
<li>
<p><code>--threshold FLOAT</code>, <code>--auto-threshold</code>, <code>--metric {f1,youden}</code></p>
</li>
<li>
<p>Random Forest:</p>
</li>
<li>
<p><code>--rf-n INT</code>, <code>--rf-depth {INT|None}</code>, <code>--rf-mf {sqrt,log2}</code></p>
</li>
<li><code>--rf-class-weight {balanced|None}</code></li>
<li><code>--rf-tune</code> … grid semplice via CV (sul train)</li>
<li><code>--rf-calibrate {isotonic,sigmoid}</code> … <strong>CalibratedClassifierCV</strong> su train</li>
<li>
<p>Logistica:</p>
</li>
<li>
<p><code>--C FLOAT</code></p>
</li>
<li>
<p>Generali:</p>
</li>
<li>
<p><code>--seed INT</code>, <code>--print-cheatsheet</code></p>
</li>
</ul>
<p><strong>Esempi</strong></p>
<pre class="codehilite"><code class="language-bash">python scripts/forest_vs_logit.py --auto-threshold
python scripts/forest_vs_logit.py --rf-calibrate isotonic --auto-threshold --print-cheatsheet
python scripts/forest_vs_logit.py --rf-tune --seed 13
</code></pre>

<p><strong>Cosa vedrai</strong></p>
<ul>
<li><strong>Baseline</strong> maggioritaria</li>
<li>Analisi <strong>punteggi RF</strong> (quantili + <strong>sweep soglia</strong>)</li>
<li>Report logit e RF (Accuracy, <strong>F1</strong>, <strong>ROC-AUC</strong>, Confusion)</li>
<li><strong>Importanze RF</strong> (da un clone non calibrato, se necessario)</li>
<li><strong>CV ROC-AUC</strong> sul train per entrambi</li>
</ul>
<hr />
<h2 id="scriptsimportance_demopy"><code>scripts/importance_demo.py</code><a class="headerlink" href="#scriptsimportance_demopy" title="Permanent link">&para;</a></h2>
<p><strong>Cosa:</strong> Importanza delle feature con Random Forest: <strong>impurity vs permutation</strong>, <strong>correlazioni</strong> e <strong>ablation</strong> (drop top-k).
<strong>Perché:</strong> non farsi ingannare dalle sole <code>feature_importances_</code>.</p>
<p><strong>Opzioni principali</strong></p>
<ul>
<li><code>--seed INT</code></li>
<li><code>--print-cheatsheet</code></li>
</ul>
<p><strong>Esempi</strong></p>
<pre class="codehilite"><code class="language-bash">python scripts/importance_demo.py
python scripts/importance_demo.py --seed 13 --print-cheatsheet
</code></pre>

<p><strong>Cosa vedrai</strong></p>
<ul>
<li><strong>AUC</strong> e <strong>Accuracy</strong> base della RF</li>
<li><strong>Impurity importance</strong> (top-k)</li>
<li><strong>Permutation importance</strong> su <strong>TEST</strong> (metrica ROC-AUC)</li>
<li><strong>Coppie molto correlate</strong> (|corr| ≥ 0.9) — warning interpretativo</li>
<li><strong>Ablation</strong>: AUC base vs AUC senza top-1 / top-3</li>
</ul>
<hr />
<h2 id="scriptsgridsearch_mixedpy"><code>scripts/gridsearch_mixed.py</code><a class="headerlink" href="#scriptsgridsearch_mixedpy" title="Permanent link">&para;</a></h2>
<p><strong>Cosa:</strong> Dati <strong>misti</strong> (numeriche + categoriche, con missing) con <strong>Pipeline/ColumnTransformer</strong> e <strong>GridSearchCV</strong> (no leakage).
Sceglie la <strong>soglia onesta</strong> da <strong>OOF</strong> (predizioni out-of-fold). Supporta <strong>Logit</strong> e <strong>RF</strong>.</p>
<p><strong>Opzioni principali</strong> (le più usate)</p>
<ul>
<li>Modello: <code>--model {logit,rf}</code></li>
<li>Soglia: <code>--auto-threshold</code>, <code>--thr-mode {f1,youden,cost}</code>, <code>--cost-fp FLOAT</code>, <code>--cost-fn FLOAT</code></li>
<li>Dati: <code>--missing FLOAT</code> (quota di valori mancanti generati), <code>--seed INT</code></li>
<li>(Altre opzioni sono mostrate da <code>--help</code>)</li>
</ul>
<p><strong>Esempi</strong></p>
<pre class="codehilite"><code class="language-bash"># Logit con soglia OOF (F1)
python scripts/gridsearch_mixed.py --model logit --auto-threshold

# RF con soglia a costo (FN 10× FP)
python scripts/gridsearch_mixed.py --model rf --auto-threshold --thr-mode cost --cost-fn 10
</code></pre>

<p><strong>Cosa vedrai</strong></p>
<ul>
<li><strong>Top configurazioni</strong> da GridSearch (per F1 CV) + AUC</li>
<li><strong>Soglia OOF</strong> scelta (criterio F1/Youden/costo)</li>
<li>Report <strong>TRAIN</strong> e <strong>TEST</strong> alla soglia scelta</li>
<li>Per <strong>Logit</strong>: <strong>Top coefficienti</strong> (segnano +/− rischio)
  Per <strong>RF</strong>: <strong>Top importanze</strong></li>
</ul>
<hr />
<h2 id="scriptspipeline_leakagepy"><code>scripts/pipeline_leakage.py</code><a class="headerlink" href="#scriptspipeline_leakagepy" title="Permanent link">&para;</a></h2>
<p><strong>Cosa:</strong> Dimostrazione <strong>leakage</strong>: confronto “sbagliato” (trasformazioni prima dello split) vs “corretto” (Pipeline solo sul train).</p>
<p><strong>Esempi</strong></p>
<pre class="codehilite"><code class="language-bash">python scripts/pipeline_leakage.py
</code></pre>

<p><strong>Cosa vedrai</strong></p>
<ul>
<li>Confronto affiancato: <strong>Accuracy</strong> e <strong>F1</strong></li>
<li><strong>CV (train)</strong> con media ± std per la versione corretta</li>
</ul>
<hr />
<h2 id="convenzioni-di-output-rapido-promemoria">Convenzioni di output (rapido promemoria)<a class="headerlink" href="#convenzioni-di-output-rapido-promemoria" title="Permanent link">&para;</a></h2>
<ul>
<li><strong>Metriche chiave:</strong> Accuracy, <strong>Precision</strong>, <strong>Recall</strong>, <strong>F1</strong>, <strong>ROC-AUC</strong></li>
<li><strong>Confusion matrix</strong> con conteggi <strong>TN/FP/FN/TP</strong> “in chiaro”</li>
<li><strong>Soglia:</strong> tabella “sweep soglia” e/o scelta <strong>auto</strong> (validation/OOF) o <strong>a costo</strong></li>
<li><strong>CV:</strong> riportata come <strong>media ± deviazione standard</strong> (k-fold sul <strong>train</strong>)</li>
</ul>
<blockquote>
<p><strong>Tip:</strong> se perdi <strong>pochi positivi</strong> è grave, abbassa la soglia; se odi i <strong>falsi allarmi</strong>, alzala. Con RF valuta <strong>calibrazione</strong> (<code>isotonic</code>/<code>sigmoid</code>) quando servono probabilità affidabili.</p>
</blockquote></div>
                <footer>
    <div class="footer-buttons">
        <div class="previous"><a href="../lessons-learned/" title="Lessons Learned"><span>Previous</span></a></div>
        <div class="next"><a href="../quiz/" title="Quiz"><span>Next</span></a></div>
    </div>
    <div class="footer-note">
        <p>
            Built with <a href="http://www.mkdocs.org">MkDocs</a> using
            <a href="https://github.com/daizutabi/mkdocs-ivory">Ivory theme</a>.
        </p>
    </div>
</footer>
            </div>
        </main>
    </div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js"></script>
    <script src="../search/main.js"></script>
</body>

</html>